"use strict";(function(){this.pixelExtensions=["volume_discounts","product_bundles","sales_notification","buyx_gety"],this.isAdmin=function(){return document.querySelector("#admin-bar-iframe")||window.Shopify.designMode},this.init=function(){this.cart=null,this.refCartItems=null,this.shopRootUrl=window.Shopify.routes.root,this.updateCartCallbacks=[],this.addCartCallbacks=[],this.pixelInit(),this.registerEvents(),this.selectorsInit()},this.pixelInit=function(){window.Shopify&&!this.isAdmin()&&(document.addEventListener("ER_PIXEL_PAGE_VIEWED",(t=>{const e=t.detail;if(e.extension&&this.pixelExtensions.includes(e.extension)){const t={extension:e.extension,productId:e.data.productId||"",rule_id:e.data?.configs?.id};"sales_notification"===e.extension&&this.shop&&this.shop.permissions&&(t.sale_notification_limit=this.shop.permissions.sale_notification_limit||0),this.sendPixel("er_page_viewed",t)}})),document.addEventListener("ER_PIXEL_PRODUCT_VIEWED",(t=>{const e=t.detail;if(e.extension&&this.pixelExtensions.includes(e.extension)){const t={extension:e.extension,productId:e.data.productId||"",rule_id:e.data?.configs?.id};this.sendPixel("er_product_viewed",t)}})),document.addEventListener("ER_PIXEL_EVENT",(t=>{const e=t.detail;if(e.extension&&this.pixelExtensions.includes(e.extension)){const t={extension:e.extension,productId:e.data.productId||"",event:e.data?.event};this.sendPixel("er_events",t)}})),document.addEventListener("ER_PIXEL_CART_ADDED",(t=>{const e=t.detail;if(e.extension&&this.pixelExtensions.includes(e.extension)){const t={extension:e.extension,productId:e.productId||"",rule_id:e?.configs?.id,quantity:e.quantity};this.sendPixel("er_add_to_cart",t)}})),document.addEventListener("ER_PIXEL_CHECKOUT_START",(t=>{const e=t.detail;if(e.extension&&this.pixelExtensions.includes(e.extension)){const t=e.data,s={extension:e.extension,data:{checkout:{token:t.token,currencyCode:t.currency,lineItems:t.items.map((e=>({id:e.product_id+"",title:e.product_title+"",quantity:e.quantity,variant:{id:e.variant_id+"",price:{amount:e.price,currencyCode:t.currency},product:{id:e.product_id+"",title:e.product_title+""},sku:e.sku}})))}}};this.sendPixel("er_checkout_start",s)}})))},this.sendPixel=function(t,e){if(window.Shopify.analytics)Shopify.analytics.publish(t,e);else{var s=0;let r=setInterval((function(){window.Shopify.analytics&&(Shopify.analytics.publish(t,e),clearInterval(r)),++s>200&&clearInterval(r)}),100)}},this.registerEvents=function(){const t=document.querySelectorAll("form[action*='/cart/add']:not(.installment)");for(const e of t){const t=e.getAttribute("id"),s=e.querySelector('[name="id"]')||document.querySelector(`input[name="id"][form="${t}"]`);s&&s.addEventListener("change",(t=>{const s=Number(t.target.value);e.dispatchEvent(new CustomEvent("ER_VARIANT_CHANGE",{detail:s}))}))}!function(t,e){"function"==typeof e&&(t.fetch=function(){const t=e.apply(this,arguments);return t.then((t=>{const e=`${window.location.origin}${window.EComRise.settings.baseUrl}`;[`${e}cart/add`,`${e}cart/add.js`].includes(t?.url)&&200===t.status&&t.clone().json().then((t=>{window.document.dispatchEvent(new CustomEvent("ER_CART_ITEM_ADD",{detail:t}))})),[`${e}cart/change`,`${e}cart/change.js`,`${e}cart/update.js`,`${e}cart/update`,`${e}cart/clear`,`${e}cart/clear.js`].includes(t.url)&&200===t.status&&t.clone().json().then((t=>{window.document.dispatchEvent(new CustomEvent("ER_CART_UPDATE",{detail:t}))}))})),t})}(window,window.fetch),document.addEventListener("ER_CART_UPDATE",(t=>{this.updateCartCallbacks.forEach((e=>{e(t.detail)}))})),document.addEventListener("ER_CART_ITEM_ADD",(t=>{this.addCartCallbacks.forEach((t=>{t()}))}))},this.selectorsInit=()=>{this.selectors||(this.selectors={formProduct:'product-form form, form.product-form, form.main-product-form, form.product-single__form, form[action*="/cart/add"]',formCart:'form[action$="/cart"] form#cart, form#CartDrawer',cartDrawer:"cart-drawer, drawer-cart",cartCount:".cart-count-bubble > span:first-child, .sf-cart-count, [data-cart-count-number],[data-cart-count], .header__cart-count .count-bubble",subtotalValue:[".totals__subtotal-value, [data-cart-subtotal-price], .sf-cart-subtotal__price, [data-cart-price], #CartDrawer [data-subtotal], .cart__page [data-subtotal]"],cartSummary:[".cart__footer > .cart__blocks > .js-contents, .sf-cart__summary .scd__summary, .scd__footer .scd__summary, .cart-drawer__footer, .m-cart__summary, #CartDrawer [data-discounts], .cart__page [data-discounts], .t4s-cart-total, .hdt-cart-totals-discounts, .cart__footer .cart__blocks, .bls-cart-footer .bls-cart-discounts, .ecom-cart__informations-container, .previewCartTotalsPrice, .cart-totals"],checkoutButton:['button[id="checkout"], button[name="checkout"], input[id="checkout"], input[name="checkout"], .hdt-mini-cart__btn-checkout, .t4s-btn__checkout']})},this.getCart=async()=>(this.cart||(this.cart=await this.Utils.fetchDataJson(EComRise.shopRootUrl+"cart.json")),this.cart),this.getDomEls=()=>Object.entries(this.selectors).reduce(((t,[e,s])=>{const r="string"==typeof s,n=r?"querySelector":"querySelectorAll",i=r?s:s[0];return t[e]=document?.[n]?.(i),!r&&t[e]&&(t[e]=[...t[e]]),t}),{}),this.clearCartTotalDomEls=t=>{let e=this.getDomEls();e.cartSummary?.length&&e.cartSummary.forEach((e=>{for(const s of e.querySelectorAll(t))s.remove()}))},this.updateCart=async()=>{document.addEventListener("ER_CART_UPDATE",(t=>{this.updateCartCallbacks.forEach((e=>{e(t)}))})),document.addEventListener("ER_CART_ITEM_ADD",(t=>{this.addCartCallbacks.forEach((t=>{t()}))}))},this.onAddedToCart=(t,e,s="")=>{switch(e){case"PAGE_CART":window.location.href=this.settings.baseUrl+"cart";break;case"CHECKOUT":window.location.href=this.settings.baseUrl+"checkout";break;case"PAGE_CURRENT":setTimeout((()=>{window.location.reload()}),1500);break;case"THEME_CART":!function(){switch(s){case"dawn":const e=document.querySelector("cart-notification")||document.querySelector("cart-drawer");e&&(e.renderContents(t),e.classList.remove("is-empty"));break;case"kalles":case"usen":case"gecko":document.dispatchEvent(new CustomEvent("cart:refresh:opend"));break;case"ecomus":document.getElementById("CartDrawer")?.openDialog(),document.documentElement.dispatchEvent(new CustomEvent("cart:refresh",{bubbles:!0}));break;case"origin":case"sense":const s=document.querySelector("cart-notification")||document.querySelector("cart-drawer"),r=document.querySelector("cart-drawer-items");document.querySelector("cart-drawer")&&document.querySelector("cart-drawer").classList.remove("is-empty"),fetch(`${Shopify.routes.cart_url}?section_id=main-cart-items`).then((t=>t.text())).then((e=>{const n=(new DOMParser).parseFromString(e,"text/html").querySelector("cart-items");r.innerHTML=n.innerHTML,s.renderContents(t)})).catch((t=>{console.error(t)}));break;case"debutify":window.ajaxCart&&"function"==typeof window.ajaxCart&&ajaxCart.load();break;case"prestige":document.dispatchEvent(new CustomEvent("product:added",{bubbles:!0,detail:{variant:t.items[0].variant_id,quantity:1}}))}}()}},this.Utils={bindEvent:(t,e,s)=>{t.split(" ").forEach((t=>{document.addEventListener(t,(function(t){t.target.matches(e+", "+e+" *")&&s.apply(t.target.closest(e),arguments)}),!1)}))},addEvent:({context:t=document.documentElement,type:e="click",selector:s,handler:r,capture:n=!1})=>{const i=function(t){for(let e=t.target;e&&e!==this;e=e.parentNode)if(e.matches(s)){r.call(e,t,e);break}};return t.addEventListener(e,i,n),()=>{t.removeEventListener(e,i,n)}},checkRequiredInput:function(t){if(!t)return;const e=t.querySelectorAll('[data-theme-fields] [name][required]:not([hidden]):not([type="hidden"])'),s=[];return e.forEach((t=>{if("radio"===t.type){const e=t.querySelectorAll(`input[name="${n.name}"]`);Array.from(e).some((t=>t.checked))||s.push(t)}else t.value||s.push(t)})),s},createDomEl(t="div",e="",s=""){const r=document.createElement(t);return e.split(" ").forEach((t=>{r.classList.add(t)})),r.innerHTML=s,r},getSessionStore(t){const e=sessionStorage.getItem(t);return e?function(t){try{JSON.parse(t)}catch(t){return!1}return!0}(e)?JSON.parse(e):e:null},setSessionStorage(t,e){sessionStorage.setItem(t,"string"!=typeof e?JSON.stringify(e):e)},deleteSessionStorage(t){sessionStorage.removeItem(t)},fetchDataJson:t=>new Promise(((e,s)=>{fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}).then((t=>{if(t.ok){const s=t.json();return e(s)}s(t)})).catch(s)})),async fetchDataHTML(t,e){try{const s=await fetch(t,{method:"GET",headers:{Accept:"text/html"}});s.ok;const r=await s.text(),n=(new DOMParser).parseFromString(r,"text/html").querySelector(e);if(!n)return null;const i=n.innerHTML.trim();return i.startsWith("{")?JSON.parse(i):i}catch(t){return console.error("Fetch error:",t),null}},calculateStorePrice(t,e=!0,s=!0){if(isNaN(t))return t;let r=parseFloat(window?.Shopify?.currency?.rate);(isNaN(r)||r<=0)&&(r=1);const n=e?t/r:t*r;return s?parseFloat(n.toFixed(2)):n},typoStyle:t=>`font-size: ${t?.font_size||"18px"};color: ${t?.color||"#000"};font-weight: ${t?.font_weight||"500"};font-style: ${t?.font_style||"normal"};line-height: ${t?.line_height||"initial"};text-transform: ${t?.text_transform||"initial"};letter-spacing: ${t?.letter_spacing||"initial"};text-decoration: ${t?.text_decoration||"initial"};`},this.init()}).bind(window.EComRise||{})(),function(t){t.data.volume_discount&&(t.VolumeDiscounts=new class{constructor(){this.initCart(),this.updateCart(),this.locale=t.data.volume_discount.hasOwnProperty("locale")?t.data.volume_discount.locale:{}}async initCart(e=null){t.clearCartTotalDomEls(".er-cart-volume-discount");let s=e;null===s&&(s=await t.getCart(),t.refCartItems||(t.refCartItems=s.items)),t.cart=s;const r=[],{ErCart:n}=await(async e=>{if(!e||!e?.items?.length)return{ErCart:e};delete e?.sections;const s={...e},n=s?.items,i=[],o=[];let a=0,c=[];const u=t.Utils.getSessionStore("ER_CartItems")||[];return n.forEach(((e,l)=>{o.push((async()=>{const o=Array.isArray(u)?u.findIndex((t=>t.key===e.key)):-1;let d,h,m;if(-1!==o){h=u[o].ER_discount_item,d=this.nearestObject(h.rules,e.quantity)}else{const t=await this.getCollectionIdsFromHandle(e.handle);h=await this.getConfigs({productId:e.product_id,collectionIds:t})}let p=h?.id||h?.volume_id;if(h?.rules.length){const o=n.reduce((function(t,s){return s.product_id===e.product_id&&(t+=s.quantity),t}),0);if(d=this.nearestObject(h.rules,o),d){let n=t.refCartItems.find((t=>t.id==e.id));const o=n?n.price:e.price,u=this.calculateDiscount(o,d,!1)*e.quantity;a+=u;const _=t.data.volume_discount.hasOwnProperty("locale")?t.data.volume_discount.locale:{},f="PERCENTAGE"===d.type?`${d.value}%`:window.EComRise.formatMoney(100*window.EComRise.Utils.calculateStorePrice(parseFloat(d.value),!1)),g="FIXED_PRICE"===d.type?(_?.text_rule_price_fixed||"Get each product for {value}").replace(/{\s*value\s*}/g,f):_.text_rule.replace(/{\s*quantity\s*}/g,d.quantity).replace(/{\s*value\s*}/g,f);m=h.title||"Volume discount",s.items[l].ER_discount_item={ruleApply:{...d,title:m,label:g},volume_id:p,rules:h.rules,price:o,line_price:e.line_price,discount_amount:this.calculateDiscount(o,d),title:m,label:g},s.items[l].erPrices||(s.items[l].erPrices={price:o}),r.push({...s.items[l]}),i.push({volume_id:p,product_id:e.product_id,label:g,rule:d});let y=c.findIndex((t=>t.id==p));y<0?c.push({id:p,title:m,discount_amount:u}):c[y].discount_amount+=u}}})())})),await Promise.all(o),i.length&&(s.attributes.ER_VolumeDiscount=i,s.ER_Price={items_subtotal_price:s.items_subtotal_price-a,original_total_price:s.original_total_price-a,discount_amount:a},s.ER_VolumeDiscount=c),{ErCart:s}})(s||{});this.cart=n,t.Utils.setSessionStorage("ER_CartItems",r),this.renderCartDiscount(),document.dispatchEvent(new CustomEvent("ER_CART_INIT",{detail:n}))}updateCart(){t.updateCartCallbacks.push((t=>{this.initCart(t)})),t.addCartCallbacks.push((t=>{this.initCart()}))}renderCartDiscount(){let e=t.getDomEls();if(e.cartSummary?.length)e.cartSummary.forEach((t=>{this.cart?.ER_Price?.discount_amount&&this.cart?.ER_VolumeDiscount&&this.cart?.ER_VolumeDiscount.forEach((e=>{t.prepend(this.cartDiscountHTML(e))}))}));else{let e=40,s=0;new Promise((r=>{let n=setInterval((()=>{let i=document.querySelectorAll(t.selectors.cartSummary);(i.length||s>=e)&&(r(i),clearInterval(n)),s++}),250)})).then((t=>{t.length&&t.forEach((t=>{this.cart?.ER_Price?.discount_amount&&this.cart?.ER_VolumeDiscount&&this.cart?.ER_VolumeDiscount.forEach((e=>{t.prepend(this.cartDiscountHTML(e))}))}))}))}this.renderCartItem()}renderCartItem(){this.cart.items.length&&(this.cart.items.forEach((e=>{if(!e?.ER_discount_item)return;const s=document.querySelector(`[data-key="${e.key}"]`);if(s){const r=e.ER_discount_item.ruleApply,n=this.calculateDiscount(e.price,r,!1),i=e.price-n;s.querySelector("[data-er-cart-item-price]")&&(s.querySelector("[data-er-cart-item-price]").innerHTML=`<span class='original_price' style='text-decoration:line-through;'>${t.formatMoney(e.price)}</span><span class='discounted_price'>${t.formatMoney(i)}</span>`),s.querySelector("[data-er-cart-item-line-price]")&&(s.querySelector("[data-er-cart-item-line-price]").innerHTML=`<span class='original_price' style='text-decoration:line-through;'>${t.formatMoney(e.original_line_price)}</span><span class='discounted_price'>${t.formatMoney(i*e.quantity)}</span>`)}})),this.cart.ER_Price&&document.querySelector("[data-er-cart-total-price]")&&(document.querySelector("[data-er-cart-total-price]").innerHTML=`<span class='original_price' style='text-decoration:line-through;'>${t.formatMoney(this.cart.total_price)}</span><span class='discounted_price'>${t.formatMoney(this.cart.total_price-this.cart.ER_Price.discount_amount)}</span>`))}cartDiscountHTML(e){if(!e?.title||!e?.discount_amount)return"";let s=`<span class="er-discount-title">\n            <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512"><path d="M497.9 225.9L286.1 14.1A48 48 0 0 0 252.1 0H48C21.5 0 0 21.5 0 48v204.1a48 48 0 0 0 14.1 33.9l211.9 211.9c18.7 18.7 49.1 18.7 67.9 0l204.1-204.1c18.7-18.7 18.7-49.1 0-67.9zm-22.6 45.3L271.2 475.3c-6.2 6.2-16.4 6.3-22.6 0L36.7 263.4A15.9 15.9 0 0 1 32 252.1V48c0-8.8 7.2-16 16-16h204.1c4.3 0 8.3 1.7 11.3 4.7l211.9 211.9c6.2 6.2 6.2 16.4 0 22.6zM144 124c11 0 20 9 20 20s-9 20-20 20-20-9-20-20 9-20 20-20m0-28c-26.5 0-48 21.5-48 48s21.5 48 48 48 48-21.5 48-48-21.5-48-48-48z"/></svg>\n            <span>${e.title}</span>\n          </span>\n          <strong class="er-discount-amount">(- ${t.formatMoney(e.discount_amount)})</strong>`;return t.Utils.createDomEl("div","er-cart-discount er-cart-volume-discount",s)}calculateDiscount(e,s,r=!0){let n=0;if("PERCENTAGE"===s.type)n=e*Number(s.value)/100;else n=t.Utils.calculateStorePrice(parseFloat(100*s.value),!1);return r?parseFloat(n).toFixed(2):parseFloat(n)}async getCollectionIdsFromHandle(e){try{let s=t.Utils.getSessionStore(`er_volume_discount_${e}`);if(s&&Array.isArray(s)&&s.length>0)return s;return s=(await t.Utils.fetchDataHTML(`${t.settings.baseUrl}products/${e}?section_id=ecomrise-product-json`,"[er-data-collections-json]")||[]).map((t=>t.id)),t.Utils.setSessionStorage(`er_volume_discount_${e}`,s),s}catch(t){console.log(t)}}async getConfigs(e={},s=!0){const{productId:r,collectionIds:n,productTags:i,productPrice:o}=e;let a=[];if(r&&t.data.volume_discount.data.length){const e=t.data.volume_discount.data;let o=null;if(e.some((t=>t.countries&&t.countries.length))){const e=await t.Utils.fetchDataJson("https://api.country.is");e&&(o=e.country)}a=e.filter((e=>{if("deactive"===e.status||"shopify_function"===e.discount_method&&s)return!1;let a=!1;const c=new Date;if((e?.active_date&&new Date(e.active_date)>c||e?.end_date&&new Date(e.end_date)<c)&&(a=!0),a)return!1;if(e?.visible){const s=e?.visible;let r=!1;switch(s?.type){case"guests":r=!t.Customer;break;case"customers":r=!!t.Customer;break;case"cutomer_tags_inc":case"cutomer_tags_exc":if("cutomer_tags_exc"!==s.type||t.Customer){let e=t.Customer.tags.split(",");if("cutomer_tags_inc"==s.type){for(let t=0;t<e.length;t++)if(s.ctags.indexOf(e[t])>=0){r=!0;break}}else{r=!0;for(let t=0;t<e.length;t++)if(s.ctags.indexOf(e[t])>=0){r=!1;break}}}else r=!0;break;default:r=!0}if(!r)return!1}if(e.countries&&e.countries.length&&(!o||!e.countries.includes(o)))return!1;if(e.hasAnyTag&&e.hasAnyTag.length){if(0===i.length)return!1;const t=i.split(",");return e.hasAnyTag.some((e=>t.includes(e)))}return"all"!==e.apply_type&&e.apply_to&&e.apply_to.length?e.apply_to.some((t=>t.id===r||n.includes(t.id))):"all"===e.apply_type}))}return!a.length&&Shopify.designMode&&(a=e),a.length?this.filterRules(a,o):null}filterRules(t,e){return t.reduce(((t,s)=>this.calculateDiscount(parseFloat(e),s.rules[0],!1)>this.calculateDiscount(parseFloat(e),t.rules[0],!1)?s:t),t[0])}nearestObject(t,e){const s=t.reduce(((t,s)=>s.quantity<=e&&Math.abs(s.quantity-e)<Math.abs(t.quantity-e)?s:t));return!(s.quantity>e)&&s}}),t.data.buyx_gety&&(t.BuyxGety=new class{constructor(){this.locale=t.data.buyx_gety.hasOwnProperty("locale")?t.data.buyx_gety.locale:{}}async getCollectionIdsFromHandle(e){try{let s=t.Utils.getSessionStore(`er_volume_discount_${e}`);if(s&&Array.isArray(s)&&s.length>0)return s;return s=(await t.Utils.fetchDataHTML(`${t.settings.baseUrl}products/${e}?section_id=ecomrise-product-json`,"[er-data-collections-json]")||[]).map((t=>t.id)),t.Utils.setSessionStorage(`er_volume_discount_${e}`,s),s}catch(t){console.log(t)}}async getConfigs(e={}){const{productId:s,collectionIds:r,productPrice:n}=e;let i=[];if(s&&t.data.buyx_gety.data.length){const e=t.data.buyx_gety.data;let n=null;if(e.some((t=>t.countries&&t.countries.length))){const e=await t.Utils.fetchDataJson("https://api.country.is");e&&(n=e.country)}i=e.filter((e=>{if("deactive"===e.status||!e.customer_get||!e.customer_buy)return!1;let i=!1;const o=new Date;if((e?.active_date&&new Date(e.active_date)>o||e?.end_date&&new Date(e.end_date)<o)&&(i=!0),i)return!1;if(e?.visible){const s=e?.visible;let r=!1;switch(s?.type){case"guests":r=!t.Customer;break;case"customers":r=!!t.Customer;break;case"cutomer_tags_inc":case"cutomer_tags_exc":if(t.Customer&&s?.ctags){let e=t.Customer.tags.split(",");if("cutomer_tags_inc"==s.type){for(let t=0;t<e.length;t++)if(s.ctags.indexOf(e[t])>=0){r=!0;break}}else{r=!0;for(let t=0;t<e.length;t++)if(s.ctags.indexOf(e[t])>=0){r=!1;break}}}else r=!1;break;default:r=!0}if(!r)return!1}return!(e.countries&&e.countries.length&&(!n||!e.countries.includes(n)))&&(e.customer_buy.resources.product.some((t=>t.id===s))&&"product"===e.customer_buy.type||e.customer_buy.resources.collection.some((t=>r.includes(t.id)&&"collection"===e.customer_buy.type)))}))}return!i.length&&Shopify.designMode&&(i=e),i.length?this.filterConfig(i):null}filterConfig(t){const e=function(t){const e=Number(t.customer_get.resources.product[0].variants[0].price);if(!t.customer_get||!t.customer_get.customer_get_discount)return e;let s=parseFloat(window?.Shopify?.currency?.rate);(isNaN(s)||s<=0)&&(s=1);let r;switch(t.customer_get.customer_get_discount[0]){case"amount":r=e-100*Number(t.customer_get.discount_amount)*s;break;case"percentage":r=e-e*(Number(t.customer_get.discount_percent)/100);break;default:r=0}return r};let s=t.filter((t=>"free"===t.customer_get.customer_get_discount[0]));return s.length?s.pop():(s=t.reduce(((t,s)=>e(s)<e(t)?s:t)),s||t.pop())}}),t.data.product_bundle&&(t.ProductBundles=new class{constructor(){this.shopRootUrl=window.Shopify.routes.root,this.initCart(),this.updateCart(),this.locale=t.data.product_bundle.hasOwnProperty("locale")?t.data.product_bundle.locale:{}}async initCart(e=null){t.clearCartTotalDomEls(".er-cart-bundle-discount");let s=e;null===s&&(s=await t.getCart(),t.refCartItems||(t.refCartItems=s.items)),t.cart=s;const r=await(async e=>{if(!e||!e?.items?.length)return{ErCart:e};delete e?.sections;const s={...e},r=s?.items;let n=await this.getConfigs({cartItems:r});return n&&n.forEach((e=>{if("active"!==e?.discount?.status)return;let n=0,i=e?.title||"Bundle discount";r.forEach((s=>{let r=t.refCartItems.find((t=>t.id==s.id)),o=r?r.price:s.price,a=-1;if(e.products.find((t=>t.id==s.product_id))){let t=this.calculateDiscountedPrice(o,e.discount,!1);if(n+=(o-t)*s.quantity,s.ER_BundleDiscounts=[{label:this.locale?.text_discount||"Bundle discount",discount_amount:o-t,discount_type:e.discount?.type,title:i}],"PERCENTAGE"===e.discount?.type)a=Number(e.discount?.value)/100;else a=100*parseFloat(e.discount?.value);s.ER_BundleDiscounts[0].discount_value=a}})),n>0&&(s.ER_BundleDiscounts||(s.ER_BundleDiscounts=[]),s.ER_BundleDiscounts.push({items_subtotal_price:s.items_subtotal_price-n,original_total_price:s.original_total_price-n,discount_amount:n,bundle_id:e.id,bundle_title:i}))})),s})(s||{});this.cart=r,this.renderCartDiscount(),document.dispatchEvent(new CustomEvent("ER_CART_INIT",{detail:r}))}async updateCart(){t.updateCartCallbacks.push((t=>{this.initCart(t)})),t.addCartCallbacks.push((t=>{this.initCart()}))}async getConfigs(e={}){const{productId:s,cartItems:r,bundleId:n}=e;let i=null;if(!t.data.product_bundle.data.length)return i;const o=t.data.product_bundle.data;if(n){return o.find((t=>t.id===n))}let a=null;if(o.some((t=>t.countries&&t.countries.length))){const e=await t.Utils.fetchDataJson("https://api.country.is");e&&(a=e.country)}return i=o.filter((e=>{if("deactive"===e.status)return!1;let n=!1;const i=new Date;if((e?.active_date&&new Date(e.active_date)>i||e?.end_date&&new Date(e.end_date)<i)&&(n=!0),n)return!1;if(e?.visible){const s=e?.visible;let r=!1;switch(s?.type){case"guests":r=!t.Customer;break;case"customers":r=!!t.Customer;break;case"cutomer_tags_inc":case"cutomer_tags_exc":if(t.Customer&&s?.ctags){let e=t.Customer.tags.split(",");if("cutomer_tags_inc"==s.type){for(let t=0;t<e.length;t++)if(s.ctags.indexOf(e[t])>=0){r=!0;break}}else{r=!0;for(let t=0;t<e.length;t++)if(s.ctags.indexOf(e[t])>=0){r=!1;break}}}else r=!1;break;default:r=!0}if(!r)return!1}if(e.countries&&e.countries.length&&(!a||!e.countries.includes(a)))return!1;if(s){if("all"===e?.apply_to?.type){if(e.products.find((t=>t.id==Number(s))))return!0}else if(e?.apply_to?.product&&e?.apply_to?.product==s)return!0}else if(r?.length){let t=0;return e.products.forEach((e=>{r.find((t=>t.product_id===e.id&&t.quantity>=e.quantity))&&t++})),t==e.products.length}return!1})),!i.length&&Shopify.designMode&&(i=o),i.length?s?i[0]:i:null}calculateDiscountedPrice(e,s,r=!0){let n=0;if("PERCENTAGE"===s.type)n=e*(1-Number(s.value)/100);else n=e-t.Utils.calculateStorePrice(parseFloat(100*s.value),!1);return r?n.toFixed(2):n}renderCartDiscount(){let e=t.getDomEls();const s=[];if(e.cartSummary?.length)e.cartSummary.forEach((t=>{this.cart?.ER_BundleDiscounts?.length&&(setTimeout((()=>{this.editFinalPrice()}),2e3),this.cart?.ER_BundleDiscounts.forEach((e=>{s.includes(e.bundle_id)||t.prepend(this.cartDiscountHTML(e)),s.push(e.bundle_id)})))}));else{let e=40,r=0;new Promise((s=>{let n=setInterval((()=>{let i=document.querySelectorAll(t.selectors.cartSummary);(i.length||r>=e)&&(s(i),clearInterval(n)),r++}),250)})).then((t=>{t.length&&t.forEach((t=>{this.cart?.ER_BundleDiscounts?.length&&(this.editFinalPrice(),this.cart?.ER_BundleDiscounts.forEach((e=>{s.includes(e.bundle_id)||t.prepend(this.cartDiscountHTML(e)),s.push(e.bundle_id)})))}))}))}}editFinalPrice(){document.querySelector("[data-er-cart-total-price]")&&(document.querySelector("[data-er-cart-total-price]").innerHTML=`<span class='original_price' style='text-decoration:line-through;'>${t.formatMoney(this.cart.total_price)}</span><span class='discounted_price'>${t.formatMoney(this.cart.total_price-this.cart.ER_BundleDiscounts.reduce(((t,e)=>t+e.discount_amount),0)-(t.VolumeDiscounts?.cart?.ER_Price?.discount_amount||0))}</span>`)}cartDiscountHTML(e){if(!e?.discount_amount||!e?.bundle_title)return"";let s=`<span class="er-discount-title">\n            <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512"><path d="M497.9 225.9L286.1 14.1A48 48 0 0 0 252.1 0H48C21.5 0 0 21.5 0 48v204.1a48 48 0 0 0 14.1 33.9l211.9 211.9c18.7 18.7 49.1 18.7 67.9 0l204.1-204.1c18.7-18.7 18.7-49.1 0-67.9zm-22.6 45.3L271.2 475.3c-6.2 6.2-16.4 6.3-22.6 0L36.7 263.4A15.9 15.9 0 0 1 32 252.1V48c0-8.8 7.2-16 16-16h204.1c4.3 0 8.3 1.7 11.3 4.7l211.9 211.9c6.2 6.2 6.2 16.4 0 22.6zM144 124c11 0 20 9 20 20s-9 20-20 20-20-9-20-20 9-20 20-20m0-28c-26.5 0-48 21.5-48 48s21.5 48 48 48 48-21.5 48-48-21.5-48-48-48z"/></svg>\n            <span>${e?.bundle_title}</span>\n          </span>\n          <strong class="er-discount-amount">(- ${t.formatMoney(e.discount_amount)})</strong>`;return t.Utils.createDomEl("div","er-cart-discount er-cart-bundle-discount",s)}})}(window.EComRise||{}),function(t){(t.installed_apps?.volume_discounts||t.installed_apps?.product_bundles||t.installed_apps?.cart_upsell)&&new class{constructor(){this.API_END_POINT="/apps/ecomrise/checkout",this.CheckoutSelectors=["input[name='checkout']","input[value='Checkout']","button[name='checkout']","[href$='checkout']","button[value='Checkout']","input[name='goto_pp']","button[name='goto_pp']","input[name='goto_gc']","button[name='goto_gc']","button.er-cart_upsell__checkout-btn","button.button-checkout","form[action='/checkout'] button[type='submit']","form[action='/checkout'] button[name='checkout']","button.qsc2-checkout-button"],this.The4Selector=["a[data-drawer-options]"],this.addEvents(),document.addEventListener("ER_CART_ADDED",(()=>{setTimeout(this.addEvents.bind(this),500)}))}addEvents(e=!0){this.CheckoutSelectors.forEach((e=>{t.Utils.bindEvent("click",e,(t=>this.handleCheckout(t,t.target)))})),window.T4SThemeSP&&e&&this.The4Selector.forEach((e=>{const s=document.querySelectorAll(e);s.length&&s.forEach((e=>{"#t4s-mini_cart"===JSON.parse(e.getAttribute("data-drawer-options")||"{}").id&&e.addEventListener("click",(()=>{t?.VolumeDiscounts&&t.VolumeDiscounts.renderCartDiscount.bind(t.VolumeDiscounts)}))}))}))}processVolumeDiscounts(e){if(!e||!t.installed_apps?.volume_discounts||!t.VolumeDiscounts?.cart)return e;const s=t.VolumeDiscounts.cart;return s?(e.ER_Price=this.calculatePrices(s.ER_Price),e.attributes={...e.attributes,ER_VolumeDiscount:s.attributes?.ER_VolumeDiscount||null,ER_VolumeDiscountTitle:s.attributes?.ER_VolumeDiscountTitle||null},Array.isArray(e.items)&&Array.isArray(s.items)?(e.items=e.items.map((t=>{if(!t)return t;const e=s.items.find((e=>e?.id===t.id));return e?.ER_discount_item?{...t,ER_discount_item:{...e.ER_discount_item,discount_amount:this.calculateStorePrice(e.ER_discount_item.discount_amount)}}:t})),e):e):e}processProductBundles(e){if(!e||!t.installed_apps?.product_bundles||!t.ProductBundles?.cart)return e;const s=t.ProductBundles.cart;return s?(s.ER_BundleDiscounts?e.ER_BundleDiscounts={...s.ER_BundleDiscounts,discount_amount:this.calculateStorePrice(s.ER_BundleDiscounts.discount_amount)}:e.ER_BundleDiscounts=null,e.attributes=s.attributes||e.attributes,Array.isArray(e.items)&&Array.isArray(s.items)?(e.items=e.items.map((t=>{if(!t)return t;const e=s.items.find((e=>e?.id===t.id));return e?.ER_BundleDiscounts?.length?{...t,ER_BundleDiscounts:e.ER_BundleDiscounts.map((t=>({...t,discount_amount:this.calculateStorePrice(t.discount_amount)})))}:t})),e):e):e}processCartUpsell(t){if(!t||!window.EComRise?.CartUpsell?.cart)return t;const e=window.EComRise.CartUpsell.cart;if(!Array.isArray(e)||!Array.isArray(t.items))return t;let s=!1;return t.items=t.items.map((t=>{if(!t)return t;const r=e.find((e=>e?.id===t.id));return r?(s=!0,{...t,ER_CartUpsellDiscounts:r.ER_CartUpsellDiscounts||null}):t})),t.ER_CartUpsellDiscounts=s?e.ER_CartUpsellDiscounts:null,t}calculateStorePrice(e){if(null==e)return null;const s=parseFloat(e);return isNaN(s)?e:t.Utils.calculateStorePrice(s)}calculatePrices(t){return t&&"object"==typeof t?Object.entries(t).reduce(((t,[e,s])=>(t[e]=this.calculateStorePrice(s),t)),{}):null}validateCheckbox(){if(!document)return!0;const e=document.querySelector("#cart_agree")||document.querySelector('.hdt-cart-checkbox [name="agree_checkbox"]');if(!e)return!0;if(!e.checked){if(window.themeHDN){const t=document.querySelector("#CartDrawer-Form")||document.querySelector("#CartPage-Form");t&&t.dispatchEvent(new Event("submit"))}else!window.T4SThemeSP&&t?.Toast?.showError&&t.Toast.showError({text:"Please agree checkbox"});return!1}return!0}async handleCheckout(e,s){if(e.preventDefault(),e.stopPropagation(),!e||!s)return;if(!this.validateCheckbox())return;let r={...t?.cart};if(!r)return console.error("Cart is not available"),void(window.location.href="/checkout");if(r=this.processVolumeDiscounts(r),r=this.processProductBundles(r),r=this.processCartUpsell(r),r.ER_Price||r.ER_BundleDiscounts||r.hasCartUpsell)try{s.style.opacity="0.7",s.style.pointerEvents="none";const e=await fetch(this.API_END_POINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cart:r,shop:Shopify?.shop,customer:t?.Customer})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();if("success"===n.status&&n.invoice_url){const t=new CustomEvent("ER_PIXEL_CHECKOUT_START",{detail:{extension:"volume_discounts",data:r}});document.dispatchEvent(t),window.location.href=n.invoice_url}else console.error("EComRise Checkout Error:",n.message,n.debug),window.location.href="/checkout"}catch(t){console.error("Checkout error:",t),window.location.href="/checkout"}finally{s.style.opacity="",s.style.pointerEvents=""}else window.location.href="/checkout"}}}(window.EComRise||{}),function(t){class e{static hideDelay=5e3;constructor(){this.toastNode=document.createElement("div"),this.toastNode.classList.add("er-toast"),document.body.appendChild(this.toastNode)}getTransitionDuration=t=>{const e=getComputedStyle(t).transitionDuration;return e.includes("ms")?parseFloat(e):1e3*parseFloat(e)};scheduleHiding(t){setTimeout((()=>this.hideMessageNode(t)),e.hideDelay)}getCrossIcon(){const t=document.createElement("div");return t.innerHTML='<svg class="er-toast__message-cross-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 348.333 348.334" fill="currentColor"><path d="M336.559,68.611L231.016,174.165l105.543,105.549c15.699,15.705,15.699,41.145,0,56.85   c-7.844,7.844-18.128,11.769-28.407,11.769c-10.296,0-20.581-3.919-28.419-11.769L174.167,231.003L68.609,336.563   c-7.843,7.844-18.128,11.769-28.416,11.769c-10.285,0-20.563-3.919-28.413-11.769c-15.699-15.698-15.699-41.139,0-56.85   l105.54-105.549L11.774,68.611c-15.699-15.699-15.699-41.145,0-56.844c15.696-15.687,41.127-15.687,56.829,0l105.563,105.554   L279.721,11.767c15.705-15.687,41.139-15.687,56.832,0C352.258,27.466,352.258,52.912,336.559,68.611z"/></svg>',t.firstChild}getMessageNode({title:t="",text:e=""}={}){const s=document.createElement("div"),r=this.getCrossIcon();return r.addEventListener("click",(()=>this.hideMessageNode(s))),s.classList.add("er-toast__message"),s.appendChild(document.createTextNode(e)),s.appendChild(r),s}showMessageNode(t){t.classList.add("er-toast__message--hidden"),requestAnimationFrame((()=>{this.toastNode.appendChild(t),requestAnimationFrame((()=>{t.classList.remove("er-toast__message--hidden")}))})),this.scheduleHiding(t)}hideMessageNode(t){t.classList.add("er-toast__message--hidden"),setTimeout((()=>{this.toastNode.contains(t)&&this.toastNode.removeChild(t)}),this.getTransitionDuration(t))}showSuccess({title:t="",text:e=""}={}){const s=this.getMessageNode({title:t,text:e});s.classList.add("er-toast__message--success"),this.showMessageNode(s)}showError({title:t="",text:e=""}={}){const s=this.getMessageNode({title:t,text:e});s.classList.add("er-toast__message--error"),this.showMessageNode(s)}}t.Toast=new e}(window.EComRise||{});